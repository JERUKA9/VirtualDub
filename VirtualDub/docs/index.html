<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<style>
BODY { background: #ffffff; color: #000000; font-family: Verdana, Arial; font-size: 12px }
H1 { font-weight: normal; font-size: 24px; background: #c0e0ff; font-family: Arial }
H2 { font-weight: normal; font-size: 20px; border-width: 0; border-bottom-width: 4px; border-color: #60c040; border-style: solid; font-family: Arial }
U { text-decoration: none; color: #800000 }
TT { font-family: Lucida Console, monospace }
PRE { font-family: Lucida Console, monospace }
DT { color: #800000; margin-top: 4px; margin-bottom: 4px; font-style: italic }
DD { color: #000000 }
TD { font-family: Verdana, Arial; font-size: 12px }
</style>
<title>VirtualDub source code - build notes</title>
</head>
<body>

<h1>VirtualDub source code - build notes</h1>

<p>
This file automatically displays the first time you attempt to build VirtualDub, in order to warn you of possible pitfalls.
It won't auto-display. Look in the <tt>Docs</tt> project for this file and other documentation.
</p>

<h2>Quickstart</h2>
<ul>
	<li>Set build target to <tt>Helpfile - Win32 Debug</tt> and build.  This will automatically build the HTML compiler,
		Lina, and the help archive.</li>

	<li>Set build target to <tt>VirtualDub - Win32 Debug</tt> and build.  This will compile the build tools, support
		libraries, then the final application.</li>
</ul>

<h2>Build requirements</h2>
<p>
	You need the following tools to build VirtualDub out of the box:
</p>
<ul>
	<li>Microsoft Windows NT 4.0, 2000, or XP.  You can build under 95/98/ME, but you will need to modify the
		build process.</li>
	<li>Microsoft Visual C++ 6.0 or Microsoft Visual Studio .NET (2003).</li>
	<li><a href="http://msdn.microsoft.com/directx/sdk/">Microsoft DirectX 9.0c Software Development Kit.</a></li>
	<li>Info-ZIP for Win32 (<tt>zip.exe</tt>).</li>
</ul>

<h2>General notes</h2>
<p>
Version 1.5.0 has a significantly different build setup than the 1.4.x series.
As of 1.5.0, mapconv and verinc are included with the main source archive,
and NekoAmp 2.0 (Priss) and Sylia are statically linked into the application.
Building VirtualDub.exe should be as simple as selecting VirtualDub as the
active project and starting a build. Special project directories:
</p>

<blockquote>
<table>
	<tr><td bgcolor="#e0e0e0">lib/&lt;build&gt;/</td>	<td bgcolor="#e0f0e0">static libraries</td></tr>
	<tr><td bgcolor="#e0e0e0">h/</td>					<td bgcolor="#e0f0e0">interface-level include files</td></tr>
	<tr><td bgcolor="#e0e0e0">obj/&lt;build&gt;/</td>	<td bgcolor="#e0f0e0">object files</td></tr>
	<tr><td bgcolor="#e0e0e0">out/&lt;build&gt;/</td>	<td bgcolor="#e0f0e0">executables and link output</td></tr>
</table>
</blockquote>

<p>
Make sure you're not releasing debug builds!
</p>

<h2>Tools</h2>
<p>
Three build tools are included in the workspace:
</p>
<blockquote>
<dl>
	<dt>disasm</dt>
	<dd>
		Compiles and checks the IA-32 architecture disassembly data module. This is not built or run
		by default, since the disassembly module rarely changes.
	</dd>

	<dt>Asuka</dt>
	<dd>
		General build tool, which has two primary functions:
		<li>
			Parses the map output from the Microsoft linker and produces an address-to-function symbol
			lookup table. This is built and run automatically as part of the build process and combines
			the <tt>virtualdub.map</tt> and <tt>ia32.vdi</tt> to produce <tt>virtualdub.vdi</tt>.
		</li>
		<li>
			Performs build number incrementing. Build information is held in <tt>version2.bin</tt> and
			reflected into <tt>version.bin</tt> for mapconv compatibility. Build counts are tracked by
			hostname, so development can occur on multiple machines and the source code control system
			in use can merge the <tt>version2.bin</tt> files to maintain the cumulative build count.
		</li>
	</dd>

	<dt>Lina</dt>
	<dd>
		A HTML compiler required to build the help file.
	</dd>
</dl>
</blockquote>

<h2>Building under Microsoft Visual C++ 6.0 (primary compiler)</h2>
<p>
In order to compile VirtualDub with Visual C++ 6.0, you <b>must</b> have the following updates
from Microsoft:
</p>
<ul>
	<li><a href="http://msdn.microsoft.com/vstudio/downloads/tools/ppack/default.asp">Visual C++ 6.0 Processor Pack</a></li>
	<li><a href="http://msdn.microsoft.com/vstudio/downloads/updates/sp/vs6/sp5/default.asp">Visual C++ 6.0 Service Pack 5</a>
		<p><b>Important</b> Do not install Visual C++ 6.0 Service Pack 6. This will render you unable to install the Processor Pack.</p>
	</li>
</ul>
<p>
You will also need updated include files from the Platform SDK. You do not need
the import libraries as VirtualDub dynamically links to functions not available
in the retail version of Windows 95.
</p>
<ul>
	<li>
		<a href="http://www.microsoft.com/msdownload/platformsdk/sdkupdate/">Platform SDK website</a></li>
		<p>
		<b>Important</b>&nbsp; Use the Download link on the toolbar to install only the Build Environment from
		the Core SDK. If you click Install this SDK! from the Core SDK link, you will forced to install all 100MB+
		of the Core SDK instead of 30MB.
		</p>
	</li>
	<li>
		<a href="http://www.microsoft.com/msdownload/platformsdk/sdkupdate/psdk-full.htm">Entire Platform SDK by regular HTTP.</a>
		This includes a lot more than you need, but this way you can archive it and not have to put up with the stupid
		online downloader.
	</li>
</ul>
<p>
MASM 6.15 or later (ML.EXE) is required to compile the assembly modules.
You should already have this from the Processor Pack.
</p>
<p>
	Newer versions of the DirectX SDK are not compatible with Visual C++ 6.0, so you will need an older version to
	link. The Summer 2004 version is recommended, which is available as of this date from:
</p>
<a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=fd044a42-9912-42a3-9a9e-d857199f888e&DisplayLang=en">http://www.microsoft.com/downloads/details.aspx?FamilyID=fd044a42-9912-42a3-9a9e-d857199f888e&DisplayLang=en</a>

<h2>Building under Microsoft Visual Studio .NET (2002)</h2>
<p>
	Building VirtualDub under Microsoft Visual Studio .NET (2002) is not supported.
</p>

<h2>Building under Microsoft Visual Studio .NET (2003)</h2>
<p>
	Visual Studio .NET automatically installs MASM 7.10, so you do not need to
	manually install an assembler.
</p>
<p>
	After importing the VC6 .dsp and .dsw files, you should make the following changes to the imported
	project files:
</p>
<ul>
	<li><b>C/C++, Code Generation, Buffer Security Check</b>: No</li>
	<li><b>C/C++, Code Generation, Runtime Library</b>: Multi-threaded (/MT) or Multi-threaded Debug (/MTd)</li>
	<li><b>C/C++, Language, Treat wchar_t as Built-in Type</b>: Yes</li>
	<li><b>C/C++, Language, For Compliance In For Loop Scope</b>: Yes</li>
</ul>

<h2>Building under Microsoft Visual Studio 2005</h2>
<p>
	After importing the VC6 .dsp and .dsw files, you should make the following changes to the imported
	project files:
</p>
<ul>
	<li><b>C/C++, Preprocessor, Preprocessor Definitions</b>: Add <tt>_CRT_SECURE_NO_DEPRECATE</tt> and <tt>_SCL_SECURE_NO_DEPRECATE</tt></li>
	<li><b>C/C++, Code Generation, Buffer Security Check</b>: No</li>
	<li><b>C/C++, Code Generation, Runtime Library</b>: Multi-threaded (/MT) or Multi-threaded Debug (/MTd)</li>
</ul>
<p>
<p>
	If you are using Standard or Express,
	then you will need to find a version of the Microsoft Macro Assembler (MASM) to use. Either MASM 6.15 from the VC6 Processor Pack or MASM 7.10 from VS.NET
	2003 will work fine.
</p>
<p>
	If you are using the Professional version, you already have MASM 8.0. However, a few changes need to be made to the
	assembly language files in order to assemble with MASM 8 &mdash; namely, MOVD and MOVQ instructions need to be changed
	as follows:
</p>
<table>
	<tr>
		<td><tt>MOVD mmreg, mem32</tt></td><td><tt>MOVD mmreg, DWORD PTR mem32</tt></td>
	</tr>
	<tr>
		<td><tt>MOVD mem32, mmreg</tt></td><td><tt>MOVD DWORD PTR mem32, mmreg</tt></td>
	</tr>
	<tr>
		<td><tt>MOVQ xmmreg, mem64</tt></td><td><tt>MOVQ xmmreg, QWORD PTR mem64</tt></td>
	</tr>
	<tr>
		<td><tt>MOVQ mem64, xmmreg</tt></td><td><tt>MOVQ QWORD PTR mem64, xmmreg</tt></td>
	</tr>
</table>
<p>
	Finally, a couple of locations may assert in the debug build due to technically incorrect usage of the Standard
	Template Library (STL). To fix these, replace expressions of the form <tt>(&amp;myVector[0])</tt> with
	<tt>(myVector.empty() ? NULL : &amp;myVector[0])</tt>.
</p>


<h2>Final notes</h2>
<p>
Good luck!
</p>

<pre>
-- Avery Lee &lt;phaeron@virtualdub.org&gt;
</pre>

</body>
</html>
